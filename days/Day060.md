Day 060 — 仕上げMarkdown（テンプレ準拠）

# Day 060 - 16k契約で整える：保存SRの食い違いを解消

## 🎯 本日のテーマ

* **サーバ保存のサンプリングレート**を16 kHzに統一し、**砂嵐/速度異常**の根因を除去

## 🧠 背景・思想

* “どうやって”やなく\*\*“どうしたい（操作）”\*\*で整理：
  **入出力の契約を固定する** → 体験の揺れを抑え、再現性を上げる

## ⚙️ 実装と試行

* **やったこと**：WSで受け取った**PCM16/mono/16k**を**WAV/16k**で保存するよう `audio_server.py` を修正
* **ポイント**：`wave.open(...).setframerate(16000)` に統一／`setsampwidth(2)`, `setnchannels(1)` 明示
* **保険**：万一float32/ステレオが来たら**モノラル化＋int16化**関数で矯正（任意）

## 📊 操作フェーズチェック

* **該当**：① 入力 / ② 出力 / ④ 見られ方

  * **入出力の契約を固定**：16k/mono/PCM16 を**契約**として明文化
  * **見られ方**：砂嵐・速度違和感の**体験劣化を排除**（＝品位担保）

## 🔁 洞察と考察

* **保存SRの一箇所ズレ**が全体の体験を壊す。
  → まず「契約」を一枚にし、処理系の**入口/出口/保存**を全て合せるのが最短

## 🪶 雑記・気づき

* 変換はクライアントで済ませて、サーバは**受けてそのまま保存**が一番トラブル少ない

## 🙏 感謝・引用

* 既存ログ（Day 059）とWhisper系の知見に感謝

## 🛠 次の挑戦メモ

* [ ] **契約ドキュメント**（16k/mono/PCM16、LUFS目安、無音閾値、許容誤差）を1枚化
* [ ] **区切り可視化**（ビープ/UI）を観客向けに追加
* [ ] **VAD＋終端検出**で可変区切りへ

## 🏷 タグ

\#I/O契約 #SR整合 #WAV #Whisper #STT #音声コーディング

---

