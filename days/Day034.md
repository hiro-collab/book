

# Day034 — RAGデータ整理の設計まとめ（引き継ぎ用）

## 🎯 本日のテーマ
- **操りたいもの**：RAG（Retrieval-Augmented Generation）投入用の**データ設計**と**運用方針**を固め、第三者に引き継げる形に整える。
- **きっかけ**：Twitterアーカイブの変換と日報群の存在を踏まえ、**実装前に設計の土台**を明確化する必要があった。
- **願い・意味**：後続の実装・評価・運用を**迷わず進められる**ようにし、**自分不在でも再現できる**標準を残す。

## 🧠 背景・思想
- 記憶より**記録を操作**するほうが再現性が高い。よって、RAGの前段で**構造・メタデータ・更新手順**を先に決める。
- 体調的に**実装まで行かない日**でも、**要件合意と設計**を進めれば翌日が軽くなる。

## ⚙️ 実装と試行（今日は設計のみ）
> ここまでの議論を「**第三者に引き継げる要約**」として整理。

### 1) 対象データ
- **Twitterアーカイブ**：`tweets.js → NDJSON`（変換済み）  
- **GitHub日報**：`hiro-collab/book` 配下の Markdown 群

### 2) コレクション設計（決定）
- **Twitter**：話題が3系統のため**3分割**（仮名）  
  - `tweets-topicA`, `tweets-topicB`, `tweets-topicC`
- **GitHub日報**：**1コレクション**に集約  
  - `daily_notes`

### 3) メタデータ共通スキーマ（案）
```json
{
  "id": "string",
  "source": "twitter|github",
  "topic": "topicA|topicB|topicC|unknown",
  "date": "YYYY-MM-DD",
  "path": "string|null",
  "url": "string|null",
  "tags": ["string"],
  "lang": "ja|en",
  "commit_sha": "string|null"
}

4) チャンク戦略（決定）

Twitter：1ツイート=1チャンク。連投は thread_id 単位で結合。

日報（Markdown）：H2/H3見出しごとに分割。800〜1200文字 / overlap 120〜160。


5) 前処理方針（決定）

Twitter：RT除外、URL保持（タグ化可）、絵文字の扱い統一。

日報：目次や自動生成部を除去、日付正規化。


6) 更新運用（決定）

Twitter：NDJSONに増分追記、id で重複排除。

GitHub日報：git diff で変更ファイルのみ再チャンク、last_indexed_sha で進捗管理。


7) 検索戦略（決定）

検索：ベクトル検索 + BM25 のハイブリッド。

フィルタ：source, topic, date_range。

クエリルーティング：必要に応じてコレクション切替 / 併用。


8) 評価方法（決定）

各コレクションに代表クエリ5本を用意。

@k=10 の Hit率で定期検証。


📊 操作フェーズチェック

該当：① 入力の据え方 / ② 出力の形 / ⑦ フローとベクトル / ⑨ 並列しておこなう操作

コメント：入力（Twitter/日報）→正規化→チャンク→索引→評価 の流れを固定。更新運用を並列に回せる粒度で設計。


🔁 洞察と考察

設計を先に共通化しておくと、後の追加データや別コーパスへの横展開が速い。

topic は辞書ベースから始め、将来的に教師あり分類で置き換える余地がある。


🪶 雑記・気づき

図式（フロー図 / データ流れ）があると、引き継ぎ時の誤解が減る。初版はテキストで十分だが、次版で追加したい。


🙏 感謝・引用

先人のRAG運用知見、Git、そして過去の自分のログに感謝。


🛠 次の挑戦メモ（TODO）

[ ] Twitter：話題ごとの分類スクリプト作成（当面はキーワードベース）。

[ ] GitHub日報：差分インデックス運用（git diff + last_indexed_sha）。

[ ] チャンク処理：Markdownを見出し単位で分割し、スライディング適用。

[ ] 評価用クエリ作成（検索精度チェックのベンチマーク）。


📝 タイトル

RAGデータ整理の設計まとめ（引き継ぎ用）

🏷 タグ

#RAG #データ設計 #NDJSON #TwitterArchive #日報 #引き継ぎ

他の形式（TXT / DOCX / ZIP）でも要るなら言うて。ここから変換して出すで。0

