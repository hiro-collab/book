
---

# Day025 — RAGボット基盤の最小パイプラインを通す（Windows 11 + Poetry + Chroma）

日付: 2025-08-13（水）
モード: 通常（※時間が無いときは「簡易モード：🎯⚙️🔁」だけ埋める）

## ⏱ フェーズ（チェックで進行管理）

* [x] 祈り／願い（目的の言語化）
* [x] 設計（分解・段取り）
* [x] 実装（手を動かす）
* [x] 振り返り（判断・教訓）
* [x] 記録（公開に耐える形へ）

---

## 🎯 1. 今日のテーマ / 狙い（Why）

* ねらい: GitHubの`days/`を取り込み→チャンク化→Chromaへ格納→検索→下書き生成まで、**ローカル最小パイプライン**を1日で通す。
* 背景・願い: 自動応答BOTを作って**自分の考えを継続発信**したい。脳の機能が落ちても、**サイボーグのように代替できる仕組み**を用意する。まずは**自分の考えをツイート**してくれるBOTから始める。
* 成功条件（Doneの定義）:

  * `storage/chunks.jsonl` が生成され、**20チャンク**以上が出力されている
  * Chromaに `days_collection` を作成し、CLI検索でヒットが返る
  * ローカルLLM（Ollama）導入（`draft_today` の1トピック動作は**未達**）
  * 使用環境を明記：**Python 3.13.5 / Poetry 1.8系 / Windows 11**
* 想定リスク・制約: Windows特有のPATH/証明書、ChromaのID重複、Poetry/pyenvの競合

## 🧠 背景・思想

* 脳の処理は**多次元的**である一方、自身はワーキングメモリの損傷により**多次元・継続メモリ**を扱いにくい。
* 現在のLLMは**一次元テキスト**処理が得意で、**置換の現実解**になり得る。
* **サイバー**＝意のままに操れる状態／領域＝**身体**。
* **可視化**＝外界の「目」向けに**認識可能な表現**でデータを出力すること。
* **BOT**＝記録された言葉から**思想ベクトル**を取り出し、**再言語化**して出力する装置（＝思考の言語化の自動化）。

## 🧪 3. 試行と実装（How）

> 手順の要点のみ（長いコードは省略）。コードを書く場合は**コメントを英語**で。

**使ったツール／技術**

* Windows 11 / PowerShell
* Python 3.13.5（pyenv-win）
* Poetry 1.8系（`.venv` と cache を**プロジェクト直下**に固定）
* GitHub `hiro-collab/book` → `local_repo/`
* ChromaDB（`days_collection` 作成）
* Ollama（`qwen2.5:7b` を pull。`draft_today` は**未達**）
* 補助：`python-certifi-win32`（PyPI 証明書対策）

**選定理由**

* Poetry：参考にした AI システムで採用／**他社と共有**を視野に入れやすい
* Chroma：ChatGPT のおすすめ
* Ollama：ChatGPT のおすすめ。手軽らしい（後で LM Studio も試す）
* pyenv：ツールごとに**バージョン切替**が必要なケースが多い

**工夫・つまずき・発見**

* 工夫：`python -m` 実行へ統一／`doc_id` を **BLAKE2b** で一意化／**改行正規化**／`.gitignore` 徹底
* つまずき：`draft_today` **未達**（原因は未特定）
* 発見：`.gitignore` の重要性。**何を共有し、何を除外**するかの分別が再現性に効く

**結果（できた／できてない）**

* チャンク数：**20+ 目標**（**実数は未把握**）
* 検索の手応え：**DB 検索は動作**
* 生成：**未達**（再試行ポイント：未設定）

## ⚙️ 作業ログ（When/What）

* 目的確認と構成決定（Poetry + Chroma + Ollama）
* `pyenv local 3.13.5`、Poetryの**venv/cache**をプロジェクト直下へ固定
* `book`を`local_repo/`へ同期→チャンク化→`storage/chunks.jsonl`作成
* Chromaに`days_collection`作成、インデックス確認
* 検索CLIで「環境構築とは何か」をクエリしヒットを確認
* Ollama導入（`qwen2.5:7b`）。`draft_today` は**未達**（要再試行）
* ハンドオーバー報告書作成、`.gitignore/.gitattributes`整備

### 付録（簡潔版）

* `.gitignore` 例：`.venv/`, `.poetry-cache/`, `.pip-cache/`, `storage/**`（`storage/.gitkeep`は残す）
* 証明書対策（要旨）：`pip install python-certifi-win32`
* Ollama PATH（恒久追加の考え方）: **システム環境変数にbinパスを追加**（GUIでも可）
* Reranker導入（要旨）：`pip install -U torch transformers accelerate FlagEmbedding`
* ハッシュIDの注意：**改行や末尾スペースは正規化**してからハッシュ化

## 📊 操作フェーズチェック

## 📊 操作フェーズチェック

* **1 祈り／願い**：入力のワザの一つ＝**ダウンロード**
* **11 振り返り／原則化**：再帰的演算のワザの一つ＝**展開・インストール**

## 🔁 洞察と考察

* **気づき**：インストール手順はREADMEだけで完結せず、利用者のブログやIssueに**分散**しがち。**集約役**が必要。
* **現実との接続**：BOTを継続運用するには**知識の供給**が持続してこそ。クローラー＝情報摂取の自動化＝**身体（操れる領域）の拡張**。
* **見せ方／見られ方**：手順は「**前提 → コマンド → 確認 → 落とし穴 → FAQ**」の5点テンプレへ**正規化**して提示すると伝わる。
* **問い直し**：「人手のREADME前提」をやめ、\*\*収集（crawl）→正規化（schema）→要約（summarize）→確認（HITL）\*\*へ設計を転換するべきでは？

## 🪶 雑記・気づき

* 記録は時間がかかる。**効率化**が必要。
* Poetry×pyenvは**置き場所**の統制が要。

## 🙏 感謝・引用

* 人 / ツール / 資料: **チャットシステムの利用の先駆者が残した記事**
* 一言: 記事を公開してくれてありがとう。分散した知見をつないでくれた。

## 🛠 次の挑戦メモ（Next）

* **明日やること**

  * BOT機能の続き（バックエンド↔フロント連携）
  * フロント側のツイート生成：テンプレ／140字最適化／自動ハッシュタグ付与
  * Slack承認→X投稿の一連フローの雛形化
  * `draft_today` の再試行：実行ログ採取と**最小再現**の切り出し
* **まだ引っかかっていること**

  * **pipx**の使い方（PATH/`ensurepath`/Poetryとの棲み分け）
  * 調査情報の**集約**方法：限定クローラー（範囲・頻度・要約スキーマ）
* **ブロッカーと回避策**

  * pipxが詰まる → 当面は `python -m pip` ＋ Poetry scripts で代替
  * モデル未接続 → LM Studio やAPIベースへ一時スイッチ（設定は抽象化して差し替え可能に）

## 📝 タイトル

* RAGボット基盤の最小パイプラインを通す（Windows 11 + Poetry + Chroma）

## 🏷 タグ

\#RAG #Chroma #Poetry #pyenv #Ollama #Windows11 #Reranker #Docs
